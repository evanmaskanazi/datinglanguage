<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-CSP" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
    <title>Restaurant Partners - Table for Two</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #e74c3c;
            --secondary-color: #3498db;
            --dark-gray: #2c3e50;
            --light-gray: #ecf0f1;
            --error-color: #e74c3c;
            --success-color: #27ae60;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #fff5f5 0%, #ffeaa7 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .restaurant-auth-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
            padding: 3rem;
        }

        .logo {
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 2rem;
        }

        h1 {
            text-align: center;
            color: var(--dark-gray);
            margin-bottom: 2rem;
            font-size: 1.5rem;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab-btn {
            flex: 1;
            padding: 1rem;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 1rem;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
            color: #666;
        }

        .tab-btn.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 600;
        }

        .tab-btn:hover {
            color: var(--primary-color);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-form h2 {
            text-align: center;
            color: var(--dark-gray);
            margin-bottom: 2rem;
            font-size: 1.25rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-input::placeholder {
            color: #999;
        }

        .btn {
            width: 100%;
            padding: 1rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .form-footer {
            text-align: center;
            margin-top: 2rem;
            color: #666;
        }

        .form-footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .form-footer a:hover {
            text-decoration: underline;
        }

        .features {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e0e0e0;
        }

        .features h3 {
            color: var(--dark-gray);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .features ul {
            list-style: none;
            padding: 0;
        }

        .features li {
            padding: 0.5rem 0;
            color: #666;
            position: relative;
            padding-left: 1.5rem;
        }

        .features li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: var(--success-color);
            font-weight: bold;
        }

        /* Custom RTL Support */
        [dir="rtl"] {
            direction: rtl;
            text-align: right;
        }

        [dir="rtl"] .form-input {
            text-align: right;
        }

        [dir="rtl"] .form-input[type="email"],
        [dir="rtl"] .form-input[type="password"] {
            text-align: left;
            direction: ltr;
        }

        [dir="rtl"] .features li {
            padding-right: 1.5rem;
            padding-left: 0;
        }

        [dir="rtl"] .features li::before {
            right: 0;
            left: auto;
        }
    </style>
</head>
<body>
    <div class="restaurant-auth-container">
        <div class="logo">üçΩÔ∏è Restaurant Portal</div>
        <h1>Restaurant Partner Portal</h1>

        <div id="alertMessage" class="alert"></div>

        <div class="auth-tabs">
            <button class="tab-btn active" onclick="showLogin()">Login</button>
            <button class="tab-btn" onclick="showRegister()">Register</button>
        </div>
        
        <div id="login-form" class="auth-form active">
            <h2>Restaurant Login</h2>
            <form id="restaurantLoginForm">
                <div class="form-group">
                    <input type="email" name="email" class="form-input" placeholder="Restaurant Email" required id="loginEmail">
                </div>
                <div class="form-group">
                    <input type="password" name="password" class="form-input" placeholder="Password" required id="loginPassword">
                </div>
                <button type="submit" class="btn">Login</button>
            </form>
        </div>
        
        <div id="register-form" class="auth-form">
            <h2>Register Your Restaurant</h2>
            <form id="restaurantRegisterForm">
                <div class="form-group">
                    <input type="text" name="name" class="form-input" placeholder="Restaurant Name" required id="restaurantName">
                </div>
                <div class="form-group">
                    <input type="email" name="email" class="form-input" placeholder="Email" required id="registerEmail">
                </div>
                <div class="form-group">
                    <input type="password" name="password" class="form-input" placeholder="Password" required id="registerPassword">
                </div>
                <div class="form-group">
                    <input type="text" name="address" class="form-input" placeholder="Address" required id="restaurantAddress">
                </div>
                <div class="form-group">
                    <select name="cuisine_type" class="form-input" required id="cuisineType">
                        <option value="">Select Cuisine Type</option>
                        <option value="Italian">Italian</option>
                        <option value="French">French</option>
                        <option value="Asian">Asian</option>
                        <option value="Mediterranean">Mediterranean</option>
                        <option value="American">American</option>
                        <option value="Mexican">Mexican</option>
                        <option value="Indian">Indian</option>
                        <option value="Chinese">Chinese</option>
                        <option value="Japanese">Japanese</option>
                        <option value="Thai">Thai</option>
                        <option value="Seafood">Seafood</option>
                        <option value="Vegetarian">Vegetarian</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <button type="submit" class="btn">Register</button>
            </form>
        </div>

        <div class="features">
            <h3>Partner Benefits:</h3>
            <ul>
                <li>Connect with verified diners</li>
                <li>Manage reservations easily</li>
                <li>Increase customer engagement</li>
                <li>Access analytics dashboard</li>
                <li>Promote special events</li>
            </ul>
        </div>

        <div class="form-footer">
            <a href="/">‚Üê Back to main site</a>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            initializeTranslation();
            initializeRestaurantAuth();
        });

        function initializeTranslation() {
            const switcher = document.createElement('div');
            switcher.id = 'languageSwitcher';
            switcher.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 1000; background: white; padding: 0.5rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);';
            switcher.innerHTML = `
                <select id="languageSelect" onchange="changeLanguage(this.value)" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.875rem;">
                    <option value="en">English</option>
                    <option value="he">◊¢◊ë◊®◊ô◊™</option>
                    <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                    <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                </select>
            `;
            document.body.appendChild(switcher);
        }

        function changeLanguage(lang) {
            const translations = {
                'he': {
                    'Restaurant Portal': '◊§◊ï◊®◊ò◊ú ◊û◊°◊¢◊ì◊ï◊™',
                    'Restaurant Partner Portal': '◊§◊ï◊®◊ò◊ú ◊©◊ï◊™◊§◊ô ◊î◊û◊°◊¢◊ì◊î',
                    'Login': '◊î◊™◊ó◊ë◊®◊ï◊™',
                    'Register': '◊î◊®◊©◊û◊î',
                    'Restaurant Login': '◊î◊™◊ó◊ë◊®◊ï◊™ ◊û◊°◊¢◊ì◊î',
                    'Restaurant Email': '◊ê◊ô◊û◊ô◊ô◊ú ◊û◊°◊¢◊ì◊î',
                    'Password': '◊°◊ô◊°◊û◊î',
                    'Register Your Restaurant': '◊®◊©◊ï◊ù ◊ê◊™ ◊î◊û◊°◊¢◊ì◊î ◊©◊ú◊ö',
                    'Restaurant Name': '◊©◊ù ◊î◊û◊°◊¢◊ì◊î',
                    'Email': '◊ê◊ô◊û◊ô◊ô◊ú',
                    'Address': '◊õ◊™◊ï◊ë◊™',
                    'Select Cuisine Type': '◊ë◊ó◊® ◊°◊ï◊í ◊û◊ò◊ë◊ó',
                    'Partner Benefits:': '◊ô◊™◊®◊ï◊†◊ï◊™ ◊©◊ï◊™◊£:',
                    'Connect with verified diners': '◊î◊™◊ó◊ë◊® ◊¢◊ù ◊°◊ï◊¢◊ì◊ô◊ù ◊û◊ê◊ï◊û◊™◊ô◊ù',
                    'Manage reservations easily': '◊†◊î◊ú ◊î◊ñ◊û◊†◊ï◊™ ◊ë◊ß◊ú◊ï◊™',
                    'Increase customer engagement': '◊î◊í◊ì◊ú ◊û◊¢◊ï◊®◊ë◊ï◊™ ◊ú◊ß◊ï◊ó◊ï◊™',
                    'Access analytics dashboard': '◊í◊ô◊©◊î ◊ú◊ú◊ï◊ó ◊ë◊ß◊®◊î ◊ê◊†◊ú◊ô◊ò◊ô',
                    'Promote special events': '◊ß◊ì◊ù ◊ê◊ô◊®◊ï◊¢◊ô◊ù ◊û◊ô◊ï◊ó◊ì◊ô◊ù',
                    '‚Üê Back to main site': '‚Üê ◊ó◊ñ◊®◊î ◊ú◊ê◊™◊® ◊î◊®◊ê◊©◊ô'
                },
                'ar': {
                    'Restaurant Portal': 'ÿ®Ÿàÿßÿ®ÿ© ÿßŸÑŸÖÿ∑ÿßÿπŸÖ',
                    'Restaurant Partner Portal': 'ÿ®Ÿàÿßÿ®ÿ© ÿ¥ÿ±ŸÉÿßÿ° ÿßŸÑŸÖÿ∑ÿßÿπŸÖ',
                    'Login': 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ',
                    'Register': 'ÿ™ÿ≥ÿ¨ŸäŸÑ',
                    'Restaurant Login': 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿßŸÑŸÖÿ∑ÿπŸÖ',
                    'Restaurant Email': 'ÿ®ÿ±ŸäÿØ ÿßŸÑŸÖÿ∑ÿπŸÖ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä',
                    'Password': 'ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±',
                    'Register Your Restaurant': 'ÿ≥ÿ¨ŸÑ ŸÖÿ∑ÿπŸÖŸÉ',
                    'Restaurant Name': 'ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ∑ÿπŸÖ',
                    'Email': 'ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä',
                    'Address': 'ÿßŸÑÿπŸÜŸàÿßŸÜ',
                    'Select Cuisine Type': 'ÿßÿÆÿ™ÿ± ŸÜŸàÿπ ÿßŸÑŸÖÿ∑ÿ®ÿÆ',
                    'Partner Benefits:': 'ŸÅŸàÿßÿ¶ÿØ ÿßŸÑÿ¥ÿ±ÿßŸÉÿ©:',
                    'Connect with verified diners': 'ÿ™ŸàÿßÿµŸÑ ŸÖÿπ ÿ±ŸàÿßÿØ ŸÖÿ§ŸÉÿØŸäŸÜ',
                    'Manage reservations easily': 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ÿ®ÿ≥ŸáŸàŸÑÿ©',
                    'Increase customer engagement': 'ÿ≤ŸäÿßÿØÿ© ÿ™ŸÅÿßÿπŸÑ ÿßŸÑÿπŸÖŸÑÿßÿ°',
                    'Access analytics dashboard': 'ÿßŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™',
                    'Promote special events': 'ÿßŸÑÿ™ÿ±ŸàŸäÿ¨ ŸÑŸÑÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿÆÿßÿµÿ©',
                    '‚Üê Back to main site': '‚Üê ÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸâ ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä'
                },
                'ru': {
                    'Restaurant Portal': '–ü–æ—Ä—Ç–∞–ª —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤',
                    'Restaurant Partner Portal': '–ü–æ—Ä—Ç–∞–ª –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤',
                    'Login': '–í–æ–π—Ç–∏',
                    'Register': '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è',
                    'Restaurant Login': '–í—Ö–æ–¥ –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞',
                    'Restaurant Email': 'Email —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞',
                    'Password': '–ü–∞—Ä–æ–ª—å',
                    'Register Your Restaurant': '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ —Å–≤–æ–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω',
                    'Restaurant Name': '–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞',
                    'Email': 'Email',
                    'Address': '–ê–¥—Ä–µ—Å',
                    'Select Cuisine Type': '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫—É—Ö–Ω–∏',
                    'Partner Benefits:': '–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–∞:',
                    'Connect with verified diners': '–°–≤—è–∑—å —Å –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–º–∏ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è–º–∏',
                    'Manage reservations easily': '–õ–µ–≥–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º',
                    'Increase customer engagement': '–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤',
                    'Access analytics dashboard': '–î–æ—Å—Ç—É–ø –∫ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–π –ø–∞–Ω–µ–ª–∏',
                    'Promote special events': '–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π',
                    '‚Üê Back to main site': '‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —Å–∞–π—Ç'
                }
            };

            if (lang === 'en') {
                document.body.dir = 'ltr';
                location.reload();
                return;
            }

            const langData = translations[lang];
            if (langData) {
                Object.keys(langData).forEach(english => {
                    document.querySelectorAll('*').forEach(element => {
                        if (element.children.length === 0 && element.textContent.trim() === english) {
                            element.textContent = langData[english];
                        }
                    });
                });
                
                if (lang === 'he' || lang === 'ar') {
                    document.body.dir = 'rtl';
                    document.body.style.fontFamily = 'Arial, sans-serif';
                } else {
                    document.body.dir = 'ltr';
                }
            }
        }

        function initializeRestaurantAuth() {
            let csrfToken = null;

            async function getCSRFToken() {
                if (csrfToken) return csrfToken;
                
                try {
                    const response = await fetch('/api/csrf-token');
                    const data = await response.json();
                    csrfToken = data.csrf_token;
                    return csrfToken;
                } catch (error) {
                    console.error('Failed to get CSRF token:', error);
                    return null;
                }
            }

            function showAlert(message, type = 'error') {
                const alertDiv = document.getElementById('alertMessage');
                alertDiv.textContent = message;
                alertDiv.className = `alert ${type}`;
                alertDiv.style.display = 'block';

                setTimeout(() => {
                    alertDiv.style.display = 'none';
                }, 5000);
            }

            // Tab switching
            window.showLogin = function() {
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
                
                event.target.classList.add('active');
                document.getElementById('login-form').classList.add('active');
            };
            
            window.showRegister = function() {
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
                
                event.target.classList.add('active');
                document.getElementById('register-form').classList.add('active');
            };

            // Handle restaurant login
            const loginForm = document.getElementById('restaurantLoginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const formData = new FormData(e.target);
                    const loginData = {
                        email: formData.get('email'),
                        password: formData.get('password')
                    };

                    try {
                        const token = await getCSRFToken();
                        const headers = {
                            'Content-Type': 'application/json',
                        };
                        
                        if (token) {
                            headers['X-CSRFToken'] = token;
                        }

                        const response = await fetch('/api/restaurant-auth/login', {
                            method: 'POST',
                            headers: headers,
                            body: JSON.stringify(loginData)
                        });

                        const data = await response.json();

                        if (response.ok) {
                            showAlert('Login successful!', 'success');
                            setTimeout(() => {
                                window.location.href = '/restaurant-dashboard.html';
                            }, 1000);
                        } else {
                            showAlert(data.error || 'Login failed');
                        }
                    } catch (error) {
                        console.error('Login error:', error);
                        showAlert('Network error. Please try again.');
                    }
                });
            }

            // Handle restaurant registration
            const registerForm = document.getElementById('restaurantRegisterForm');
            if (registerForm) {
                registerForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const formData = new FormData(e.target);
                    const registrationData = {
                        name: formData.get('name'),
                        email: formData.get('email'),
                        password: formData.get('password'),
                        address: formData.get('address'),
                        cuisine_type: formData.get('cuisine_type')
                    };

                    const requiredFields = ['name', 'email', 'password', 'address', 'cuisine_type'];
                    const missingFields = requiredFields.filter(field => !registrationData[field]);
                    
                    if (missingFields.length > 0) {
                        showAlert(`Please fill in all required fields: ${missingFields.join(', ')}`);
                        return;
                    }

                    try {
                        const token = await getCSRFToken();
                        const headers = {
                            'Content-Type': 'application/json',
                        };
                        
                        if (token) {
                            headers['X-CSRFToken'] = token;
                        }

                        const response = await fetch('/api/restaurant-auth/register', {
                            method: 'POST',
                            headers: headers,
                            body: JSON.stringify(registrationData)
                        });

                        const data = await response.json();

                        if (response.ok) {
                            showAlert('Registration successful! You can now log in.', 'success');
                            setTimeout(() => {
                                showLogin();
                                document.getElementById('loginEmail').value = registrationData.email;
                            }, 2000);
                        } else {
                            showAlert(data.error || 'Registration failed');
                        }
                    } catch (error) {
                        console.error('Registration error:', error);
                        showAlert('Network error. Please try again.');
                    }
                });
            }

            // Pre-load CSRF token
            getCSRFToken();
        }
    </script>
</body>
</html>
